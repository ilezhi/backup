# ascii, unicode, utf-8, utf-16, utf-32 扫盲

数据在计算机内都是以二进制的形式存储.计算机发明之初,想向计算机内输入点数据,
也只能输入0和1.这太不直观了.如果要直接输入字母,就需要转换成二进制后再存储.
转换的过程称之为编码.但是该如何编码呢?

美国人就统计了需要编码的字符,一共128个.其中包括:
1. 控制字符,
2. 数字0-9,
3. 26个字母的大小写,
4. 标点符号和运算符号.

将这些字符从0开始编号直到127就够了.
转换成二进制就是`00000000 ~ 01111111`,一个字节(8位二进制)就能够表示所有字符.

**美国国家标准学会**(American National Standard Institute, ANSI)将此规则制定成
编码标准.称为**美国标准信息交换码**(American Standard Code for Information Interchange, ASCII).
也就是我们熟知的**ASCII码**.

之后又使用了ASCII码的128-255范围值,编码一些其它字符,如音标,图形符号等等.称为**扩展ASCII码**

随着计算机的发展, 许多国家也都引入了计算机. 每个非英语国家都需要将自己的文字和符号编码到计算机内.
比如中国, 为了将常用的几千汉字进行编码,同时又为了兼容ASCII码(0-127与ASCII码表示的字符一致), 
出现了**GB2312**和之后的**GBK**.

如果每个国家都有一套自己的编码规则, 在自己国内用没什么问题. 如果要和不同编码规则的地区进行通信,交换数据.
就会导致显示乱码无法识别等问题. 需要安装专门的软件来进行编码规则之间的转换. 多一套编码规则, 就需要为此编码
规则与其它编码规则各写一套转换规则. 这显然是不利于计算机发展的.

此时一个叫**ISO**(International Organization for Standardization, 国际标准化组织)的国际组织注意
到了此问题.并开始着手解决此问题.创建了一套能够编码所有国家的问题和符号的字符集.称为**UCS**(Universal Character Set, 通用字符集). 
别名**Unicode**. 使用两个字节编码为UCS-2, 4个字节编码为UCS-4.

## UCS-2, UCS-4
UCS-2使用两个字节编码. 则编码的范围是 `00000000 00000000` - `11111111 11111111`. 十进制就是0-65535.
一共可以编码65536个字符. 能够编码绝大多数国家的字母和符号,包括两万多中文．但是已知的中文有8万多个. 如何涵盖
剩下的4万多汉字, 同时还要保留一些用于扩展.

解决上述问题就是使用UCS-4采用4个字节编码. `0xxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx`. UCS-4规定高字节8位
中的最高位为0, 剩下7位可以分成**2^7=128个group**, 每个group可以根据次字节分为**2^8=256个plane**. 每个
plane可以根据第三个字节分为**2^8=256个row**, 每个row可以根据最后一个字节分为**2*8=256个cell**. 
当group=0的平面(plane)也为0时称为**BMP**(Basic Multilingual Plane). 将BMP(group=0, plane=0)的前两字节
去掉就得到UCS-2. **Unicode**使用了17(0-16)个平面(plane). 则可以编码`17 * 65536 = 1114112`个字符.
完全够把地球上的所有文字,符号,字母编码. 大多数字符都编码在0平面上(BMP), 也就是`0x00 0000 - 0x00 FFFF`(16进制表示).

### UTF-8, UTF-16, UTF-32

Unicode字符集是给每一个字符分配一个码位(也可以说是编号). 要将这个编号存储到计算机内, 就需要转换成二进制形式.
不同的码位需要的二进制位数不同. 比如字母'a'的Unicode码为97, 需要一个字节(8位). 汉字"码"的Unicode码为30721
16进制为0x7801, 就需要至少两个字节(16位). 而那些码位超过0xFFFF,就需要超过2个字节才行. 到底用几个字节来存储
Unicode码?

UTF-16统一使用两个字节编码Unicode码.比如字符'a'的Unicode码为97,二进制为`1100001`, 不够两个字节(16位)就用0补为
`00000000 01100001`, "字"的Unicode码为23383, 二进制为`1011011 01010111`, 补够16位`01011011 01010111`.
Unicode码大多在0平面, 也就是在范围`0 - 65535`, 刚好是两个字节能表示的范围. 所以在此范围的Unicode码使用UTF-16编码
与原值相同. 但是超过65535的Unicode码就需要两个双字节,一共四个字节才能编码.
比如'𠮷'的Unicode码为134071,16进制为0x20bb7, 已经超过0平面的最大值65536(0xFFFF). 如何转换成两个双字节表示要按照下面的规则.
U' = U - 0xFFFF;
U为字符的Unicode码, 带入则为
U' = 0x20BB7 - 0xFFFF = 0x10BB6;




UTF-8使用字节(8位)为单位编码Unicode. 换句话说UTF-8编码不同Unicode值需要的字节数不同.这样做是非常有必要的.
Unicode至少使用2个字节来编码(UCS-2, BMP), 但是对于英语国家来说, 一个字节就够了, 如果使用两个字节就会造成
巨大的存储空间浪费. 如果进行传输时, 则会传输大量`00000000`全零字节. UTF-8就解决了这个问题.对于那些与ASCII码
一致的则使用一个字节. 其它Unicode码使用几个字节也是有规则的.

|Unicode码范围(十六进制)    |     UTF-8 编码(二进制)                       |
| --------                |     -----                                  |
| 00 0000 - 00 007F       |     0xxxxxxx                               |
| 00 0080 - 00 07FF       |     110xxxxx 10xxxxxx                      |
| 00 0800 - 00 FFFF       |     1110xxxx 10xxxxxx 10xxxxxx             |
| 01 0000 - 10 FFFF       |     11110xxx 10xxxxxx 10xxxxxx 10xxxxxx    |

图中左侧UTF-8将Unicode的17个平面范围分成了4部分, 前三部分都属于平面0, 第四部分为剩余16(01-10)个平面.
第一部分与ASCII编码一致, 使用一个字节, 第一位为0. 






